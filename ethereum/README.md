# Ethereum Contracts

Solidity smart contracts and tests for snowbridge.

## Development

Requirements:
* Node 16 LTS: https://github.com/nvm-sh/nvm
* direnv: https://direnv.net/docs/installation.html

Install dependencies with yarn:

```bash
yarn install
```

Create an `.envrc` file using [.envrc.template](.envrc.template) as a template. Note that deploying to goerli network requires setting the INFURA_PROJECT_ID and ROPSTEN_PRIVATE_KEY environment variables.

Example:

```bash
cp .envrc-example .envrc
direnv allow
```

## Testing

Run tests:

```bash
npx hardhat test
```

## Test Fixtures

Some of the unit tests require fixture data generated by a live deployment. For this purpose, we use logging artifacts from the offchain relayers in the [E2E](../test) stack.

To generate logging artifacts, run the following E2E tests:

```bash
yarn test --grep 'should transfer DOT from Substrate to Ethereum \(basic channel\)'
yarn test --grep 'should transfer ETH from Ethereum to Substrate \(basic channel\)'
yarn test --grep 'should transfer DOT from Substrate to Ethereum \(incentivized channel\)'
```

### BEEFY commitments

BEEFY commitment & proofs extracted from `../test/beefy-relay.log` and copied into:
* `test/beefy/data/beefy-commitment.json`

For updating `basic-commitment.json`:
1. Search for `Sent SubmitFinal transaction` in `beefy-relay.log`
2. Copy into `test/beefy/data/beefy-commitment.json`

### Message bundles

Message bundles are extracted from `../test/parachain-relay.log` and copied into:
* `test/channels/data/basic-commitment.json`
* `test/channels/data/incentivized-commitment.json`

For updating `basic-commitment.json`:
1. Search for `Sent transaction BasicInboundChannel.submit` in `parachain-relay.log`
2. Copy the necessary fields into `test/channels/data/basic-commitment.json`

For updating `incentivized-commitment.json`:
1. Search for `Sent transaction IncentivizedInboundChannel.submit` in `parachain-relay.log`
2. Copy the necessary fields into `test/channels/data/incentivized-commitment.json`

## Deployment

### Local

Example: Run a local hardhat instance with deployments

```
yarn hardhat node
```

### Goerli

```
yarn hardhat deploy --network goerli
```
