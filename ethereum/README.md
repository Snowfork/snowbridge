# Ethereum Contracts

This directory contains smart contracts utilized by the Polkadot-Ethereum Bridge.

## Development

Requirements:
* Node 14 LTS. See installation [instructions](https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-20-04#option-3-%E2%80%94-installing-node-using-the-node-version-manager).
* Yarn

Install dependencies with yarn:

```bash
yarn install
```

Create an `.env` file using the `env.template` as a template. Note that deploying to ropsten network requires setting the INFURA_PROJECT_ID and ROPSTEN_PRIVATE_KEY environment variables.

Example:

```bash
cp env.template .env
```

## Testing

Run tests on the hardhat network:

```bash
yarn test
```

## Deployment

### Local

Example: Run a local hardhat instance with deployments

```
yarn hardhat node
```

### Ropsten, Mainnet

```
yarn hardhat deploy --network ropsten
```

## Tasks

### Upgrade an app

Example: upgrade an app to use a different set of channels

```sh
# Do something first to deploy new channels, then provide addresses below
yarn hardhat upgrade \
  --appaddr       0x9A676e781A523b5d0C0e43731313A708CB607508 \
  --basicinbound  0x0000000000000000000000000000000000000001 \
  --basicoutbound 0x0000000000000000000000000000000000000002 \
  --incinbound    0x0000000000000000000000000000000000000003 \
  --incoutbound   0x0000000000000000000000000000000000000004 \
  --network       localhost # change to ropsten or mainnet accordingly
```

### Renounce ownership of the CHANNEL_UPGRADE_ROLE

```sh
yarn hardhat renounce \
  --appaddr 0x9A676e781A523b5d0C0e43731313A708CB607508 \
  --network localhost
```

## Autogenerated Documentation

Solidity documentation can be autogenerated using the [solidity-docgen](https://github.com/OpenZeppelin/solidity-docgen) library. It will generate markdown files from the contracts directory and output them to the docs directory.

```bash
# The library is only compatible with npx
npx solidity-docgen
```
