# Ethereum Contracts

This directory contains smart contracts utilized by the Polkadot-Ethereum Bridge.

## Development

Make sure you use a recent node version, e. g. with [nvm](https://github.com/nvm-sh/nvm#installing-and-updating):

```bash
nvm install 14.16.1
nvm use 14.16.1
```

Install dependencies with yarn:

```bash
yarn install
```

Create an `.env` file using the `env.template` as a template. Note that deploying to ropsten network requires setting the INFURA_PROJECT_ID and MNEMONIC environment variables.

Example:

```bash
cp env.template .env
```

## Testing

Make sure the truffle environment is running, then run tests

```bash
npx hardhat test

# In a new terminal, test application gas expenditures
truffle test test/test_eth_app.js

# Run all tests
truffle test
```

## Scripts

The project includes several useful scripts for interacting with the bridge.

Gets information about a transaction:

``` bash
truffle exec scripts/getTx.js [tx-hash]
```

Gets an ETH balance for an address:

``` bash
truffle exec scripts/getEthBalance.js [ethereum-address]
```

Gets an ERC20 token balance for an address:

``` bash
truffle exec scripts/getERC20Balance.js [ethereum-address] [token-contract-address]
```

Deposits ETH into the ETHApp, initiating a cross-chain transfer to Substrate:

``` bash
truffle exec scripts/sendEth.js [amount] [polkadot-recipient]
```

Deposits ERC20 tokens into the ERC20App, initiating a cross-chain transfer to Substrate:

``` bash
truffle exec scripts/sendERC20.js [amount] [token-contract-address] [polkadot-recipient]
```


## Autogenerated Documentation

Solidity documentation can be autogenerated using the [solidity-docgen](https://github.com/OpenZeppelin/solidity-docgen) library. It will generate markdown files from the contracts directory and output them to the docs directory.

```bash
# The library is only compatible with npx
npx solidity-docgen
```

## Footnotes

<span id="f1">1</span>:
* Make sure to read [Yarn docs](https://classic.yarnpkg.com/en/docs/cli/global/) regarding global packages and path in case `truffle` is not working.
* Alternatively, you could skip this step and install dependencies locally in the next step. In that case `truffle` will be installed only for the current project and you'll need to invoke it with `yarn run truffle`.
